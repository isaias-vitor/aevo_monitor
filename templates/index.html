{% extends 'base.html' %}

{% block content %}


  <div class="container p-0">
    
    <div id="recepcao" class="my-5 d-flex justify-content-between align-items-center">
      <h2 class="d-inline col-8 m-0 mt-5">Bem vindo <strong>{{current_user.nome}}!</strong></h2>
      
      {% if current_user.level == 'monitor' %}
        <button class="btn btn-outline-secondary btn-szm mt-5 mb-3" data-bs-toggle="modal" data-bs-target="#modal-relatorio">Novo Relatório</button>
      {% endif %}
    </div>
  
    <div id="relatorios-abertos" class="container p-0 mb-5">
      <div class="d-flex justify-content-between">
        <h3 class="col-6">Relatórios</h3>
        <div class="d-flex col-6 justify-content-end">
          <button class="btn btn-light d-flex rounded-circle p-1" id="scrollLeft">
            <i class='bxr bxs-chevron-left'  style='font-size: 2rem;'></i> 
          </button>
          <button class="btn btn-light d-flex rounded-circle p-1 " id="scrollRight">
            <i class='bxr bxs-chevron-right'  style='font-size: 2rem;'></i> 
          </button>
        </div>
      </div>
      <div id="cardsContainer" class="d-flex overflow-auto">
        {% for report in reports %}
          <div class="card-relatAberto border mt-4 col-2 me-2 p-2 rounded-4 bg-white flex-shrink-0">
            <div class="text-center d-flex flex-column">
              <div class="mb-1">
                {% if report.turno == 'noturno' %}
                  <i class="bi bi-moon-stars-fill text-light-emphasis" style="font-size: 4.5rem;"></i>
                {% else %}
                  <i class="bi bi-sun-fill text-light-emphasis" style="font-size: 4.5rem;"></i>
                {% endif %}
              </div>
              <div class="mb-4">
                <h3 class="mb-0"><strong>{{report.responsavel}}</strong></h3>
                <p class="text-secondary mb-1">{{ report.dia }}</p>
                {% if report.status == True %}
                  <span class="bg-success-subtle p-1 rounded-pill text-success border border-success">Aberto</span>
                {% else %}
                  <span class="bg-danger-subtle p-1 rounded-pill text-danger border border-danger">Fechado</span>
                {% endif %}
              </div>
              <div>
                <a href="{{url_for('relatorio', id_relatorio=report.id, empresa = 'Athon', ufv='Brasilia 100')}}">
                  <button class="btn btn-secondary col-9">Visualizar</button>
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  
  
    <div class="modal fade" id="modal-relatorio" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5">Abrir Novo Relatório</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
  
          {% if open_report %}
            <div class="modal-body">
              Já existe um relatório aberto por este usuário no dia {{ open_report[0].dia }}! Feche-o antes de abrir um novo!
            </div>
  
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Ok</button>
            </div>
          {% else %}
            <div class="modal-body">
              Ao abrir um novo relatório o mesmo estará atrelado a seu usuário, e não será permitida a abertura de um novo até que este seja fechado!
            </div>
            <div class="modal-footer">
              <form method="post">
                {{ form.hidden_tag() }}
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                {{ form.submit(class='btn btn-primary') }}
              </form>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  </body>
  </html>

  <script>
    document.getElementById('icon-home').classList.add('bg-body-secondary')
  </script>

  <script>
    const container = document.getElementById("cardsContainer");
  
    function scrollAmount() {
      return container.clientWidth * 0.9; // rola quase uma tela
    }
  
    document.getElementById("scrollLeft").addEventListener("click", () => {
      container.scrollBy({ left: -scrollAmount(), behavior: "smooth" });
    });
  
    document.getElementById("scrollRight").addEventListener("click", () => {
      container.scrollBy({ left: scrollAmount(), behavior: "smooth" });
    });
  </script>
{% endblock %}
