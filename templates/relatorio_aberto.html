{% if current_user.level == 'gestor' %}
    {% extends 'base_gestor.html' %}
{% else %}
    {% extends 'base.html' %}
{% endif %}

{% block content %}

    <div class="container mt-5 p-0">
        <div id="titulo-pagina " class="my-5 d-flex justify-content-between align-items-center">
            <h2 class="d-inline mt-5 col-8 m-0">Relatórios</h2>
        </div>

        <div id="selecao-ufv" class="container p-0 mb-5">
            <div class="row justify-content-between">
                <div class="
                    {% if status == True and id_responsible == current_user.id %} col-5
                    {% else %} col-6
                    {% endif %}
                ">
                    {% if current_user.level == 'gestor' %}
                        <input id="empresas-select" class="form-control" value="{{current_user.company}}" disabled>
                    {% else %}
                        <select id="empresas-select" class="form-select">
                            <option value="Athon">Athon</option>
                            <option value="Mirai">Mirai</option>
                        </select>
                    {% endif %}    
                </div>
                <div class="
                    {% if status == True and id_responsible == current_user.id %} col-5
                    {% else %} col-6
                    {% endif %}
                ">
                    <select id="ufv-select" class="form-select">
                        <option value="Brasilia 100" selected>Brasilia 100</option>
                        <option value="Brasilia 200">Brasilia 200</option>
                        <option value="Bela Vista de Goias 100">Bela Vista de Goias 100</option>
                        <option value="Morro Agudo 100">Morro Agudo 100</option>
                        <option value="Santa Rita 100">Santa Rita 100</option>
                        <option value="Tres Lagoas">Tres Lagoas 100</option>
                    </select>
                </div>
                {% if status and id_responsible == current_user.id %}
                    <div class="col-2 d-flex justify-content-end pe-4">

                        <div data-bs-toggle="tooltip" data-bs-placement="top" title="Multi-Registro">
                            <button class="btn btn-outline-dark d-flex rounded-circle p-2 me-2" data-bs-toggle="modal" data-bs-target="#modal-multi">
                                <i class='bxr bx-checks'></i> 
                            </button>
                        </div>

                        <a href="{{url_for('usina', ufv=ufv_aberto)}}" data-bs-toggle="tooltip" data-bs-placement="top" title="Ir para UFV">
                            <button class="btn btn-outline-dark d-flex rounded-circle p-2 me-2">
                                <i class='bx  bx-solar-panel'></i> 
                            </button>
                        </a>

                        {%if status_ufv%}
                        <div data-bs-toggle="tooltip" data-bs-placement="top" title="Usina Online">
                            <button class="btn btn-outline-dark d-flex rounded-circle p-2 me-2" data-bs-toggle="modal" data-bs-target="#modal-status">
                                <i class='bx bx-signal-5'></i> 
                            </button>
                        </div>
                        {%else%}
                        <div data-bs-toggle="tooltip" data-bs-placement="top" title="Usina Offline">
                            <button class="btn btn-dark d-flex rounded-circle p-2 me-2" data-bs-toggle="modal" data-bs-target="#modal-status">
                                <i class='bx bx-signal-slash'></i> 
                            </button>
                        </div>
                        {%endif%}
                        
                        <div data-bs-toggle="tooltip" data-bs-placement="top" title="Fechar Relatório">
                            {{form_close_report.hidden_tag()}}
                            <button type="submit" class="btn btn-outline-dark d-flex rounded-circle p-2" data-bs-toggle="modal" data-bs-target="#modal-close-report">
                                <i class='bxr bx-x'></i> 
                            </button>
                        </div>

                    </div>
                {% endif %}
            </div>
        </div>

        <div id="relatorios" class="container row p-0">
            <div class="col col-9">
                <div class="d-flex justify-content-between mb-3">
                    <h4>Registros</h4>
                    {% if status and current_user.level == 'monitor'%}
                        <button class="btn btn-light d-flex rounded-circle mb-1 p-2" onclick="modalElipse(this)">
                            <i class='bxr bx-plus'></i> 
                        </button>
                    {% endif %}

                </div>
                <div class="container bg-light-subtle border rounded-3 p-3">
                    <table id="tabela-usina" class="table table-borderless table-sm m-0 rounded-3 p-5">
                        <thead>
                            <tr>
                                <th scope="col" class="text-center">Horário</th>
                                <th scope="col" class="text-center">Referência</th>
                                <th scope="col" class="text-center">Status</th>
                                <th scope="col" class="text-center">Observação</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for report in reports %}
                                <tr class="
                                    {% if report.status == 'Ok': %} ok 
                                    {% elif report.status == 'Sem conexão' or report.status[0] != '0': %} sem-conexao
                                    {% else: %} ocorrencia {% endif %}
                                " id="{{report.id}}">
                                    <td scope="row" class="text-center">{{report.horario}}</td>
                                    <td class="text-center">{{report.referencia}}</td>
                                    <td class="text-center">{{report.status}}</td>
                                    <td class="text-center">
                                    {% if report.observacao != '' %} {{ report.observacao }}
                                    {% else %} -
                                    {% endif %}
                                    </td>
                                    <td class="text-end">
                                        {% if status %}
                                            {% if report.referencia == 'Usina' %}
                                                <button class="btn btn-link btn-edit rounded-circle btn-sm text-warning p-1" onclick="modalElipse(this)">
                                                    <i class='bxr bxs-edit-alt text-secondary' style="font-size:1.5rem"></i> 
                                                </button>
                                            {% endif %}
                                            <button class="btn btn-link btn-delete rounded-circle btn-sm text-danger p-1" onclick="modalDeleteElipse(this)">
                                                <i class='bxr bxs-trash-x text-secondary' style="font-size:1.5rem"></i> 
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col col-3">
                <div class="d-flex justify-content-between mb-3">
                    <h4>Câmeras</h4>
                    {% if status %}
                        <form method="post" id="form-copyCamReport">
                            {{form_copy_report_local.hidden_tag() }}
                            <button class="btn btn-light d-flex rounded-circle mb-1 p-2" name="{{form_copy_report_local.submit_copy_report_local.name}}" value="1">
                                <i class='bxr bxs-copy-list'></i> 
                            </button>
                        </form>
                    {% endif %}
                </div>
                <div class="cardUsina rounded-3 bg-white border p-2">
                    <table id="tabela-cameras" class="table table-hover table-borderless text-center table-sm">
                        <thead>
                            <tr>
                            <th scope="col">Nome</th>
                            <th scope="col">Status</th>
                            <th scope="col" class="col-6">Observações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if status %}
                                {% for cam in cams %}
                                    <tr class="{{cam.status}}" data-id="{{cam.id}}" data-nome="{{cam.nome}}" data-status="{{cam.status}}" data-observacao="{{cam.observacao}}">
                                        <td scope="row" class="text-center">{{cam.nome}}</td>
                                        <td class="text-center">{{cam.status | capitalize}}</td>
                                        <td class="text-center">{{cam.observacao}}</td>
                                    </tr>
                                {% endfor %}                                    
                            {% else %}
                                {% for company in cams_closed_report %}
                                    {% for ufv, cams in company.items() %}
                                        {% if ufv == ufv_aberto %}
                                            {% for cam in cams %}
                                                <tr class="{{cam.status}}" data-id="{{cam.id}}" data-nome="{{cam.nome}}" data-status="{{cam.status}}" data-observacao="{{cam.obs}}">
                                                    <td scope="row" class="text-center">{{cam.nome}}</td>
                                                    <td class="text-center">{{cam.status | capitalize}}</td>
                                                    <td class="text-center">{{cam.obs}}</td>
                                                </tr>
                                            {% endfor %}
                                        {% endif %} 
                                    {% endfor %}
                                {% endfor %}
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div id="ocorrencias" class="container row mt-4 p-0">
            <div class="col">
                <div class="d-flex justify-content-between mb-1">
                    <h4>Ocorrências</h4>
                    {% if status and current_user.level == 'monitor'%}
                        <button class="btn btn-light d-flex rounded-circle mb-1 p-2" onclick="new_occurrence()">
                            <i class='bxr bx-plus'></i> 
                        </button>
                    {% endif %}

                </div>
                <div class="container bg-light-subtle border rounded-3 p-3">
                    <table id="tabela-ocorrencias" class="table table-borderless table-hover table-sm m-0 rounded-3 p-5">
                        <thead>
                            <tr>
                                <th scope="col" class="text-center">#</th>
                                <th scope="col" class="text-center">Data</th>
                                <th scope="col" class="text-center">Horário</th>
                                <th scope="col" class="text-center">Status</th>
                                <th scope="col" class="text-center">Ações</th>
                                <th scope="col" class="text-center">Observações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for occurrence in occurrences_report %}
                                {% if occurrence.usina == ufv_aberto %}
                                    <tr data-id="{{occurrence.id}}" data-data="{{occurrence.data}}" data-horario="{{occurrence.horario}}" data-status="{{occurrence.status}}" data-acoes="{{occurrence.acoes}}" data-obs="{{occurrence.observacoes}}" class="cursor-pointer">
                                        <th scope="row" class="text-center">{{occurrence.id}}</th>
                                        <td class="text-center d-flex align-items-center">{{occurrence.data}}</td>
                                        <td class="text-center">{{occurrence.horario}}</td>
                                        <td class="text-center text-capitalize">{{occurrence.status}}</td>
                                        <td class="text-center"> {{occurrence.acoes}} </td>
                                        <td> {{occurrence.observacoes}} </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
        </div>

    </div>
  
    <div class="modal fade" id="modal-relatorio-elipse" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="tituloModalElipse" class="modal-title fs-5">Novo Registro - Elipse</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="form-addUFV" method="post">

                    {{ form_elipse.hidden_tag() }}
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">Horário</label>
                                {{ form_elipse.time() }}
                            </div>
                            <div class="col-6">
                                <label class="form-label">Status</label>
                                {{ form_elipse.status() }}
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <label class="form-label">Observações</label>
                                {{ form_elipse.observation() }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_elipse.submit_create_report() }}
                    </div>
                </form>

                <form id="form-editUFV" hidden method="post">

                    {{ form_edit_record.hidden_tag() }}
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">Horário</label>
                                {{ form_edit_record.timeEditElipse() }}
                            </div>
                            <div class="col-6">
                                <label class="form-label">Status</label>
                                {{ form_edit_record.statusEditElipse() }}
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <label class="form-label">Observações</label>
                                {{ form_edit_record.observationEditElipse() }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_edit_record.id_recordEditElipse(class="visually-hidden") }}
                        {{ form_edit_record.submit_edit_record() }}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-multi" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="tituloModalElipse" class="modal-title fs-5">Multi Registros</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body" id="lista-multi">
                    {% for empresa in empresas %}
                        {% for usina in empresas[empresa] %}
                            <div class="d-flex justify-content-between py-1">
                                <div class="col-8">{{usina}}</div>
                                <select class="form-select form-select-sm" id="{{usina}}">
                                    <option value="Ok" selected>Ok</option>
                                    <option value="Sem conexão">Sem conexão</option>
                                    <option value="Religamento">Religamento</option>
                                    <option value="Incêndio">Incêndio</option>
                                    <option value="Furto">Furto</option>
                                    <option value="Invasão">Invasão</option>
                                  </select>
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>

                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="truco()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-delete-elipse" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="tituloModalElipseDelete" class="modal-title fs-5">Excluir Registro</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="form-deleteRecord" method="post">
                    {{ form_delete_record.hidden_tag() }}
                    <div class="modal-body text-center">
                        Tem certeza que deseja excluir este registro? Após a confirmação, não será possivel recupera-lo.
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_delete_record.id_recordDeleteElipse(class="visually-hidden") }}
                        {{ form_delete_record.submit_delete_record() }}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-camera" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="titulo-modalCamera" class="modal-title fs-5"></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="form-editCamera" method="post">
                {{ form_edit_cam_record.hidden_tag() }}
                {{ form_edit_cam_record.id_cam_edit_record(hidden=True) }}
                    <div class="modal-body">
                                        
                        <label class="form-label mt-3">Status</label>
                        {{ form_edit_cam_record.status_edit_cam_record(class='form-select') }}
            
                        <label class="form-label mt-3">Observação</label>
                        {{ form_edit_cam_record.obs_edit_cam_record(class='form-control') }}
            
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_edit_cam_record.submit_edit_cam_record(class='btn btn-primary') }}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-status" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="titulo-modalCamera" class="modal-title fs-5">Alterar status de usina</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    Deseja realmente mudar o status da usina?
                </div>
                <div class="modal-footer">
                   <form id="form-editCamera" method="post">
                        {{ form_no_connect_ufv.hidden_tag() }}
                    
                        {{ form_no_connect_ufv.submit_no_connect_ufv(class='btn btn-primary') }}
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-ocorrencia" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="titulo-modalOccurrence" class="modal-title fs-5">Nova Ocorrência</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="form-addOccurrence" method="post">

                    {{ form_add_occurrence.hidden_tag() }}
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-4">
                                <label class="form-label">Data</label>
                                {{ form_add_occurrence.date_add_occurrence(class='form-control') }}
                            </div>
                            <div class="col-3">
                                <label class="form-label">Horário</label>
                                {{ form_add_occurrence.hour_add_occurrence(class='form-control') }}
                            </div>
                            <div class="col-5">
                                <label class="form-label">Status</label>
                                {{ form_add_occurrence.status_add_occurrence(class='form-select') }}
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <label class="form-label">Ações</label>
                                {{ form_add_occurrence.actions_add_occurrence(class='form-control') }}
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <label class="form-label">Observações</label>
                                {{ form_add_occurrence.observations_add_occurrence(class='form-control') }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_add_occurrence.submit_add_occurrence(class='btn btn-primary') }}
                    </div>
                </form>

                <form id="form-editOccurrence" method="post">

                    {{ form_edit_occurrence.hidden_tag() }}
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-4">
                                <label class="form-label">Data</label>
                                {{ form_edit_occurrence.date_edit_occurrence(class='form-control') }}
                            </div>
                            <div class="col-3">
                                <label class="form-label">Horário</label>
                                {{ form_edit_occurrence.hour_edit_occurrence(class='form-control') }}
                            </div>
                            <div class="col-5">
                                <label class="form-label">Status</label>
                                {{ form_edit_occurrence.status_edit_occurrence(class='form-select') }}
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <label class="form-label">Ações</label>
                                {{ form_edit_occurrence.actions_edit_occurrence(class='form-control') }}
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <label class="form-label">Observações</label>
                                {{ form_edit_occurrence.observations_edit_occurrence(class='form-control') }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_edit_occurrence.id_edit_occurrence(class="visually-hidden") }}
                        <div class="d-flex">
                            <div class="col-6 px-1 py-2">
                                {{ form_edit_occurrence.submit_edit_occurrence(class='btn btn-primary col-12') }}
                            </div>
                            <div class="col-6 px-1 py-2">
                                <button type="button" data-bs-target="#modal-delete-ocorrencia" data-bs-toggle="modal" class="btn btn-danger col-12" name="btn-delete-ocorrencia" id="btn-deleteOcorrencia">Excluir</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-delete-ocorrencia" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="tituloModalOcorrenciaDelete" class="modal-title fs-5">Excluir Ocorrência</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="form-deleteRecord" method="post">
                    {{ form_delete_occurrence.hidden_tag() }}
                    <div class="modal-body text-center">
                        Tem certeza que deseja excluir esta ocorrência? Após a confirmação, não será possivel recupera-la.
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_delete_occurrence.id_delete_occurrence(class="visually-hidden") }}
                        {{ form_delete_occurrence.submit_delete_occurrence(class='btn btn-danger')}}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-close-report" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 id="tituloModalOcorrenciaDelete" class="modal-title fs-5">Fechar Relatório</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="form-deleteRecord" method="post">
                    {{ form_close_report.hidden_tag() }}
                    <div class="modal-body text-center">
                        Tem certeza que deseja fechar este relatório? Após a confirmação, apenas um admnistrador poderá reabri-lo.
                    </div>
                    
                    <div class="modal-footer">
                        {{ form_close_report.submit_close_report(class='btn btn-danger')}}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Impede que usuario ultilize URL para acessar outras usinas -->
    {% if current_user.level == 'gestor' %}
        <script>
            let parametros = window.location.pathname;
            parametros =  parametros.split('/')
            empresa_url = parametros[3]
            if(empresa_url != `{{current_user.company}}`){
                window.location.href = "{{ url_for('gestor', empresa=current_user.company) }}";
            }
        </script>
    {% endif %}
      
    <script>
        document.getElementById('icon-relatorios').classList.add('bg-body-secondary')

        function truco(){

            var selects = document.querySelectorAll('#lista-multi select')
            var multiUfvs = {}
            var dados = {}

            selects.forEach(ufv => {
                multiUfvs[ufv.id] = ufv.value    
            });

            dados['multiUfvs'] = multiUfvs
            dados['id_report'] = '{{id_relatorio }}'

            const agora = new Date();
            const horas = String(agora.getHours()).padStart(2, '0');
            const minutos = String(agora.getMinutes()).padStart(2, '0');
            const horario = `${horas}:${minutos}`;

            dados['hora'] = horario

            fetch('/salvar_multi_relatorios', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                window.location.reload();
            })
            .catch(err => {
                console.error(err);
            });
        }
    </script>  

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

    <script>
        function inserirHora() {
          const agora = new Date();
          const horas = String(agora.getHours()).padStart(2, '0');
          const minutos = String(agora.getMinutes()).padStart(2, '0');
    
          const horario = `${horas}:${minutos}`;
          document.getElementById("time").value = horario;
        }
    </script>

    <script> 


        const optionsEmpresas = {{ empresas | tojson }};

        const empresa = `{{empresa}}`
        
        const empresaSelect = document.getElementById('empresas-select');
        const usinaSelect = document.getElementById('ufv-select');

        console.log(optionsEmpresas)
        
        empresaSelect.value = empresa;
        usinaSelect.innerHTML = '';
        optionsEmpresas[empresa].forEach(ufv => {
            const option = document.createElement('option');
            option.value = ufv;
            option.text = ufv;
            usinaSelect.appendChild(option);
        });

        usinaSelect.value = `{{ufv_aberto}}`

        empresaSelect.addEventListener('change', function(){
            const urlBase = "{{ url_for('relatorio', id_relatorio = id_relatorio, empresa = '_EMPRESA_', ufv = '_UFV_') }}"
            const url = urlBase.replace('_EMPRESA_', empresaSelect.value).replace('_UFV_', optionsEmpresas[empresaSelect.value][0])
            window.location.href = url
        })

        usinaSelect.addEventListener('change', function(){
            const urlBase = "{{ url_for('relatorio', id_relatorio = id_relatorio, empresa = '_EMPRESA_', ufv = '_UFV_') }}"
            const url = urlBase.replace('_EMPRESA_', empresaSelect.value).replace('_UFV_', usinaSelect.value)
            window.location.href = url
        })

    </script>

    <script>
        function modalElipse(botao) {

            if(botao.classList.contains('btn-edit')){
                document.getElementById('tituloModalElipse').innerText = 'Editar Registro - Elipse'
                document.getElementById('form-addUFV').hidden = true;
                document.getElementById('form-editUFV').hidden = false;
                let linha = botao.closest('tr')
                let dados = linha.querySelectorAll('td');
                let valores = Array.from(dados).slice(0, -1).map(td => td.innerText);
                
                document.getElementById('id_recordEditElipse').value = linha.id;
                document.getElementById('timeEditElipse').value = valores[0]
                document.getElementById('statusEditElipse').value = valores[1]
                if(valores[2] != '-' ) {
                    document.getElementById('observationEditElipse').value = valores[2]
                }else{
                    document.getElementById('observationEditElipse').value = ''
                }
            }else{
                document.getElementById('form-editUFV').hidden = true;
                document.getElementById('form-addUFV').hidden = false;
                inserirHora();
            }
            
            let modal = new bootstrap.Modal(document.getElementById('modal-relatorio-elipse'));
            modal.show();
        }

        function modalDeleteElipse(botao){
            if(botao.classList.contains('btn-delete')){
                let linha = botao.closest('tr')
                document.getElementById('id_recordDeleteElipse').value = linha.id;
            }

            let modal = new bootstrap.Modal(document.getElementById('modal-delete-elipse'));
            modal.show();
        }
    </script>

    <script>

        document.querySelectorAll("#tabela-ocorrencias tbody tr").forEach(tr => {
            tr.addEventListener("click", () => {
                var data = tr.dataset.data;
                const horario = tr.dataset.horario;
                const status = tr.dataset.status;
                const acoes = tr.dataset.acoes;
                const obs = tr.dataset.obs;
        
                document.getElementById('form-editOccurrence').hidden = false
                document.getElementById('form-addOccurrence').hidden = true
                document.getElementById('titulo-modalOccurrence').innerText = 'Editar Ocorrencia'
        
                document.getElementById('id_edit_occurrence').value = tr.dataset.id;
                document.getElementById('id_delete_occurrence').value = tr.dataset.id;

                data = data.split('/')
                const dia = data[0]
                const mes = data[1]
                const ano = data[2]
        
                document.getElementById("date_edit_occurrence").value = `${ano}-${mes}-${dia}`;
                document.getElementById("hour_edit_occurrence").value = horario;
                document.getElementById("status_edit_occurrence").value = status;
                document.getElementById("actions_edit_occurrence").value = acoes;
                document.getElementById("observations_edit_occurrence").value = obs;
        
                const modal = new bootstrap.Modal(document.getElementById("modal-ocorrencia"));
                modal.show();
            });
        });

        function new_occurrence(){
            document.getElementById('form-addOccurrence').hidden = false
            document.getElementById('form-editOccurrence').hidden = true
            document.getElementById('titulo-modalOccurrence').innerText = 'Nova Ocorrência'

            const agora = new Date();
            const hora = agora.getHours().toString().padStart(2, '0');
            const minutos = agora.getMinutes().toString().padStart(2, '0');

            document.getElementById("date_add_occurrence").value = agora.toISOString().split('T')[0];
            document.getElementById("hour_add_occurrence").value = `${hora}:${minutos}`
            document.getElementById("status_add_occurrence").option = 'Religamento';
            document.getElementById("actions_add_occurrence").value = '';
            document.getElementById("observations_add_occurrence").value = '';

            const modal = new bootstrap.Modal(document.getElementById("modal-ocorrencia"));
            modal.show();
        }

    </>

    {% if status %}
        <script>
            document.querySelectorAll("#tabela-cameras tbody tr").forEach(tr => {
                tr.addEventListener("click", () => {
                    const nome = tr.dataset.nome;
                    const status = tr.dataset.status;
                    const obs = tr.dataset.observacao;

                    document.getElementById('id_cam_edit_record').value = tr.dataset.id;

                    document.getElementById("titulo-modalCamera").innerText = nome;
                    document.getElementById("status_edit_cam_record").value = status;
                    document.getElementById('obs_edit_cam_record').value = obs;

                    const modal = new bootstrap.Modal(document.getElementById("modal-camera"));
                    modal.show();
                });
            });
        </script>
    {% endif %}

<script>
    // Inicializa todos os tooltips da página
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    const tooltipList = [...tooltipTriggerList].map(el => new bootstrap.Tooltip(el));
</script>
{% endblock %}